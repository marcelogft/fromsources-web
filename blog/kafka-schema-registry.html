<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kafka Schema Registry | From Sources</title>
    <meta name="description" content="Some Apache Kafka Schema Registry notes.">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css">
    
    <link rel="preload" href="/fromsources-web/assets/css/0.styles.08ac24d0.css" as="style"><link rel="preload" href="/fromsources-web/assets/js/app.805b7b41.js" as="script"><link rel="preload" href="/fromsources-web/assets/js/4.8898a6db.js" as="script"><link rel="preload" href="/fromsources-web/assets/js/1.a380d8b6.js" as="script"><link rel="preload" href="/fromsources-web/assets/js/28.338ff4b2.js" as="script"><link rel="prefetch" href="/fromsources-web/assets/js/10.83b89ba7.js"><link rel="prefetch" href="/fromsources-web/assets/js/11.d56c6a5c.js"><link rel="prefetch" href="/fromsources-web/assets/js/12.bbee6052.js"><link rel="prefetch" href="/fromsources-web/assets/js/13.33ef5605.js"><link rel="prefetch" href="/fromsources-web/assets/js/14.33c59328.js"><link rel="prefetch" href="/fromsources-web/assets/js/15.7c7da050.js"><link rel="prefetch" href="/fromsources-web/assets/js/16.6dbab5ad.js"><link rel="prefetch" href="/fromsources-web/assets/js/17.eb8352a3.js"><link rel="prefetch" href="/fromsources-web/assets/js/18.41214848.js"><link rel="prefetch" href="/fromsources-web/assets/js/19.c38c0dcb.js"><link rel="prefetch" href="/fromsources-web/assets/js/20.483d8f6c.js"><link rel="prefetch" href="/fromsources-web/assets/js/21.ae83da79.js"><link rel="prefetch" href="/fromsources-web/assets/js/22.84259f36.js"><link rel="prefetch" href="/fromsources-web/assets/js/23.282314da.js"><link rel="prefetch" href="/fromsources-web/assets/js/24.9b608495.js"><link rel="prefetch" href="/fromsources-web/assets/js/25.2871ebe2.js"><link rel="prefetch" href="/fromsources-web/assets/js/26.a6c1f0fe.js"><link rel="prefetch" href="/fromsources-web/assets/js/27.5c258e33.js"><link rel="prefetch" href="/fromsources-web/assets/js/29.7374c9f8.js"><link rel="prefetch" href="/fromsources-web/assets/js/30.30499579.js"><link rel="prefetch" href="/fromsources-web/assets/js/31.1b8521d9.js"><link rel="prefetch" href="/fromsources-web/assets/js/32.2c363502.js"><link rel="prefetch" href="/fromsources-web/assets/js/33.3a1fb015.js"><link rel="prefetch" href="/fromsources-web/assets/js/5.bb141625.js"><link rel="prefetch" href="/fromsources-web/assets/js/6.12c846f7.js"><link rel="prefetch" href="/fromsources-web/assets/js/7.6db3fbc6.js"><link rel="prefetch" href="/fromsources-web/assets/js/8.85e0043c.js"><link rel="prefetch" href="/fromsources-web/assets/js/9.a60a4127.js"><link rel="prefetch" href="/fromsources-web/assets/js/vendors~docsearch.f92eab53.js">
    <link rel="stylesheet" href="/fromsources-web/assets/css/0.styles.08ac24d0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fromsources-web/" class="home-link router-link-active"><!----> <span class="site-name">From Sources</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fromsources-web/" class="nav-link">Home</a></div><div class="nav-item"><a href="/fromsources-web/blog/" class="nav-link router-link-active">Blog</a></div><div class="nav-item"><a href="/fromsources-web/about/" class="nav-link">About</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fromsources-web/" class="nav-link">Home</a></div><div class="nav-item"><a href="/fromsources-web/blog/" class="nav-link router-link-active">Blog</a></div><div class="nav-item"><a href="/fromsources-web/about/" class="nav-link">About</a></div> <!----></nav>  <!----> </div> <div class="page"> <div class="content default"><p><img src="https://2.bp.blogspot.com/-jL5Th4PnNQE/Wq6n45Br3PI/AAAAAAABOnE/aACQB9pthd0d09p3brNWN8mYxDtY9FJigCLcBGAs/s1600/Avro-Kafka.png" alt="An image"></p> <h1 id="schemas"><a href="#schemas" aria-hidden="true" class="header-anchor">#</a> Schemas</h1> <p>A consistent data format is important in Kafka, as it allows writing and reading messages to be decoupled</p> <p>By using well-defined schemas and storing them in a common repository, the messages in Kafka can be understood without coordination.</p> <p>JSON / XML  =&gt; Lack features such as robust type handling and compability between schema versions.</p> <p><strong>Apache Avro</strong>, serialization framework.</p> <ul><li>Compact serialization format, schemas that are separate from the message payloads</li> <li>Do not rqueire code to be generated when they change</li> <li>String data typing and schema evolution.</li> <li>Backward and forward compatibility.</li></ul> <h1 id="confluent-schema-registry"><a href="#confluent-schema-registry" aria-hidden="true" class="header-anchor">#</a> Confluent Schema Registry</h1> <p>Schema Registry is a distributed storage layer for Avro Schemas which uses Kafka as its underlying storage mechanism. Data is stored on brokers.</p> <p>The Confluent Schema Registry is your safeguard against incompatible schema changes and will be the component that ensures no breaking schema evolution will be possible. Kafka Brokers do not look at your payload and your payload schema, and therefore will not reject data.</p> <p>It provides a RESTful interface for storing and retrieving Avro schemas. Clients can interact with the schema registry using the HTTP or HTTPS interface.</p> <ul><li><p>Assigns globally unique ID to each registered schema. Allocated IDs are guaranteed to be monotonically increasing but not necessarily consecutive.</p></li> <li><p>Kafka provides the durable backend, and functions as a write-ahead changelog for the state of Schema Registry and the schemas it contains.</p></li> <li><p>Schema Registry is designed to be distributed, with single-master architecture, and ZooKeeper/Kafka coordinates master election (based on the configuration).</p></li> <li><p>The Schema Registry stores all the schemas in the <strong>_schemas</strong> Kafka topic</p></li></ul> <p>First local cache is checked for the message schema. In case of cache miss, schema is pulled from the schema registry. An exception will be thrown in the Schema Registry does not have the schema (which should never happen if you set it up properly)</p> <p>Schema Registry reports a variety of metrics through JMX. It can also be configured to report stats using additional pluggable stats reporters using the metrics.reporters configuration option. The easiest way to view the available metrics is to use jconsole to browse JMX MBeans.</p> <p><a href="https://docs.confluent.io/current/schema-registry/monitoring.html" target="_blank" rel="noopener noreferrer">Metrics<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h1 id="schema-compatibility"><a href="#schema-compatibility" aria-hidden="true" class="header-anchor">#</a> Schema compatibility</h1> <p>Schema compatibility checking is implemented in Schema Registry by versioning every single schema
The compatibility type determines how Schema Registry compares the new schema with previous versions of a schema, for a given subject.</p> <p><a href="https://docs.confluent.io/current/schema-registry/avro.html#summary" target="_blank" rel="noopener noreferrer">Compatibility Types<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li><strong>BACKWARD</strong> - consumers using the NEW schema can read data produced with the last schema. -- DEFAULT --</li> <li><strong>BACKWARD_TRANSITIVE</strong>: consumer using schema X can process data produced with schema X, X-1, or X-2</li></ul> <p><em>There is no assurance that consumers using older schemas can read data produced using the new schema. Therefore, upgrade all consumers before you start producing new events.</em></p> <ul><li><strong>FORWARD</strong> compatibility means that data produced with a new schema can be read by consumers using the last schema, even though they may not be able to use the full capabilities of the new schema</li> <li><strong>FORWARD_TRANSITIVE</strong>: data produced using schema X can be ready by consumers with schema X, X-1, or X</li></ul> <p><em>There is no assurance that consumers using the new schema can read data produced using older schemas. Therefore, first upgrade all producers to using the new schema and make sure the data already produced using the older schemas are not available to consumers, then upgrade the consumers.</em></p> <ul><li><strong>FULL</strong>: backward and forward compatibile between schemas X and X-1</li> <li><strong>FULL_TRANSITIVE</strong>: backward and forward compatibile between schemas X, X-1, and X-2</li></ul> <p><em>There are assurances that consumers using older schemas can read data produced using the new schema and that consumers using the new schema can read data produced using older schemas. Therefore, you can upgrade the producers and consumers independently.</em></p> <ul><li><strong>NONE</strong> compatibility type means schema compatibility checks are disabled.</li></ul> <p><em>Compatibility checks are disabled. Therefore, you need to be cautious about when to upgrade clients.</em></p> <h2 id="schema-id-allocation"><a href="#schema-id-allocation" aria-hidden="true" class="header-anchor">#</a> Schema ID allocation</h2> <p>Schema ID allocation always happen in the master node and they ensure that the Schema IDs are monotonically increasing.</p> <h2 id="api"><a href="#api" aria-hidden="true" class="header-anchor">#</a> API</h2> <div class="language- extra-class"><pre class="language-text"><code> curl -X GET http://localhost:8081/config
 {&quot;compatibility&quot;:&quot;BACKWARD&quot;}
</code></pre></div><h1 id="avro"><a href="#avro" aria-hidden="true" class="header-anchor">#</a> AVRO</h1> <p>An Avro schema defines the data structure in a JSON format.</p> <p>One of the interesting things about Avro is that it not only requires a schema during data serialization, but also during data deserialization.</p> <p>optional field in an Avro record =&gt; <strong>doc</strong></p> <h2 id="subject-name-strategy"><a href="#subject-name-strategy" aria-hidden="true" class="header-anchor">#</a> Subject Name Strategy</h2> <p>Avro serializer registers a schema in Schema Registry under a subject name, which essentially defines a namespace in the registry:</p> <ul><li>Compatibility checks are per subject</li> <li>Versions are tied to subjects</li> <li>When schemas evolve, they are still associated to the same subject but get a new schema id and version</li></ul> <p>The subject name depends on the subject name strategy, which you can set to one of the following three values:</p> <p><strong>TopicNameStrategy</strong> (io.confluent.kafka.serializers.subject.TopicNameStrategy) – this is the default
<strong>RecordNameStrategy</strong> (io.confluent.kafka.serializers.subject.RecordNameStrategy)
<strong>TopicRecordNameStrategy</strong> (io.confluent.kafka.serializers.subject.TopicRecordNameStrategy)</p> <p>Clients can set the subject name strategy for either the key or value, using the following configuration parameters:</p> <ul><li><strong>key.subject.name.strategy</strong></li> <li><strong>value.subject.name.strategy</strong></li></ul></div> <div class="page-edit"><!----> <!----></div> <!----> <section><div class="layout my-5 column wrap align-center"><div class="flex my-3 xs12 sm4"><div class="text-xs-center"><div><span data-link="#share-facebook"><i aria-hidden="true" class="v-icon fab fa-facebook-square theme--light blue--text text--darken-2" style="font-size:36px;cursor:pointer;"></i></span> <span data-link="#share-linkedin"><i aria-hidden="true" class="v-icon fab fa-linkedin theme--light blue--text text--darken-2" style="font-size:36px;cursor:pointer;"></i></span> <span data-link="#share-twitter"><i aria-hidden="true" class="v-icon fab fa-twitter-square theme--light blue--text text--darken-2" style="font-size:36px;cursor:pointer;"></i></span></div></div></div></div></section> </div> <!----></div><div class="global-ui"><!----></div></div>
    <script src="/fromsources-web/assets/js/app.805b7b41.js" defer></script><script src="/fromsources-web/assets/js/4.8898a6db.js" defer></script><script src="/fromsources-web/assets/js/1.a380d8b6.js" defer></script><script src="/fromsources-web/assets/js/28.338ff4b2.js" defer></script>
  </body>
</html>
